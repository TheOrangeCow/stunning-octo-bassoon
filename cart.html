<!DOCTYPE html>
<html>
<head>
  <title>Cart</title>
</head>
<body>
  <h1>Cart</h1>
  <button id="checkoutBtn">Checkout</button>

  <script>
    const backendUrl = "https://cheese-backend-x01h.onrender.com";

    // Example cart
    const cart = [
      { name: "Cheese", price: 15, quantity: 2 },
      { name: "pop Pack", price: 3, quantity: 5 }
    ];

    // 1️⃣ Ping backend when page loads to wake it up
    window.addEventListener("load", async () => {
      try {
        await fetch(`${backendUrl}/ping`);
        console.log("Backend ping successful — service is awake.");
      } catch (err) {
        console.warn("Backend ping failed. Service may be asleep or unreachable.");
      }
    });

    // 2️⃣ Checkout function
    async function checkout() {
      try {
        const res = await fetch(`${backendUrl}/create-session`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ cart })
        });

        const data = await res.json();
        if (data.url) window.location = data.url;
        else alert("Error: " + data.error);
      } catch (err) {
        alert("Failed to contact backend. Try again in a few seconds.");
        console.error(err);
      }
    }

    document.getElementById("checkoutBtn").addEventListener("click", checkout);
  </script>
</body>
</html>
